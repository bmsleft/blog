## 万事皆有因

最近在学习机器学习，看到了深度学习这一部分。用tensorflow写了几个例子，CNN的，然后在我的15年版的MacbookPro上跑了跑了，训练速度真是不忍直视，而且，风扇呼呼转，真是心疼我这个Mac了。于是意识到显卡这个东西真是个门槛。因此才想着搞一台高配置的主机来跑深度网络。

## 主机配件选购

既然是跑深度学习，那么直接在电商网站上搜一下深度学习主机买来不就得了？ 理论总是那么简单。。。
事实上，我看了下专门跑深度学习的主机，基本都是服务器级别的，动辄2W+ 。我是没这么多银子来投入这个的，没办法，穷人啊。

那么，想一下自己需求，找一个合适的主机吧。我的目的也很简单的：

- 能跑深度网络
- 可以当作我个人的服务器来运行，以弥补我的MBP的性能不足
- 先来没事可以打打win上的大游戏 啊哈哈 吃鸡吃鸡
- 能省点钱就省点钱
- 满足一下组装理想主机的小小念头

好了， 这么一罗列就明确了，就是一个高配游戏主机喽。不要误会，这是巧合～～ 于是 我去闲鱼上瞅了瞅，看出点门道，一般i7 8700 + 1080Ti显卡的主机，就可以卖到1W了～～ 啧啧 游戏真是败家。 

一开始我也想着直接买个这种主机，省事儿，不过既然都花到1W了，对各个配置外观就很在意了。看了很多主机，感觉都不是理想中的样子，要么机箱丑， 要么主板渣，要么硬盘和内存规格不够。其实我主要在意的是CPU和显卡，只要这两个满足就OK啊，然后就可以慢慢攒出自己想要的主机了。我看了闲鱼上的价格，i7 8代CPU的价格，代购的话也就2500左右，为了以后升级考虑，直接上了i7 8086K（这是个intel为了纪念第一代8086芯片40周年的纪念品，其实是从8700K中挑出来的体质好的片），4GHZ，高主频，干事儿快。1080Ti的显卡是最具性价比的了，二手价格4K左右，不过容易踩到雷买到挖矿的卡～ 这个小心了。

总的来说，各个配件都准备妥当了，来一下清单：

| 配件 | 型号                   | 价格 | 说明                                                         |
| ---- | ---------------------- | ---- | ------------------------------------------------------------ |
| CPU  | intel i7 8086K 4.0GHZ  | 2750 | 美亚代购全新盒装，马来西亚产                                 |
| 主板 | 微星 Z370 carbon       | 850  | 闲鱼二手，8成新吧，为了无锁的CPU搞了个Z系列的主板，也是操碎了心，没超频需求的可以更便宜些，1K以内 |
| 显卡 | 影驰大将 1080TI        | 3850 | 淘宝 网吧回收件，看了下，成色不错，至少没有被拿去挖矿        |
| 内存 | 影驰 名人堂 3600 8*2   | 950  | 不得不说，内存条真是贵，9成新，和主板一起闲鱼                |
| 电源 | 鑫谷GP700G金牌电源600W | 300  | 显卡的要求功率比较高，但显卡的话，推荐600W。淘宝全新         |
| 硬盘 | 铭瑄480G M2固态 复仇者 | 644  | 好像买到最后没太多银子买三星的970硬盘的，就找了个性价比高的，用着还行，淘宝铭瑄专卖店 |
| 散热 | 九州风神水元素120T     | 200  | 高主频的CPU还是配个水冷才能压住吧～  不过这个声音有点大，应该事先调查一下选个静音效果更好的 |
| 机箱 | 追风者P300             | 249  | 机箱倒是看了很久，淘宝选了个能装得下ATX大板主板的最小的主机，外观看着养眼，USB都是3.0的，RGB光效好看 |

总计： 9800吧～(真贵)～  总的来说，必直接先闲鱼上的主机要好一些，多了可配置性。

##组装

这个就不展开了，按照说明书一步步来就好。主要是安装顺序以及接线。
安装顺序：电源装到机箱 -> CPU装到主板 -> 主板装到机箱 -> 水冷 散热风扇 -> 接线
这里有两个地方需要注意：

- 机箱风道的设计：目前的机箱基本上是前进风，后 上出风。
- 散热接线： 水冷头要接PUMP(如果有的话，微星主板有这个专用接头)，水冷散热风扇接CPU_FAN，吹向显卡的那个风扇最好直接接电源12V。然后主板BIOS设置风扇为PWM智能模式。（一开始我接线错了，风扇呜呜转，太响了，然后才注意到这个事情）

最后上个成品图 啊哈哈～ 

![](https://ws2.sinaimg.cn/large/006tNbRwly1fw86lljyfnj30u0140act.jpg)

## 安装双系统

这么好的显卡不玩玩游戏是不是亏了？？ 那就保留一个win系统吧～ 

现在网上的双系统如何安装帖子都是老教程了～ Ubuntu都发布了18.04，支持UEFI+GPT。那么如何搞呢？

首先，先安装win10，如果是自己制作U盘启动项，务必选择UEFI+GPT组合模式，也就是做用UEFI模式引导，硬盘为GPT格式。如果不是，那么需要检查一下并完成转换，这里有个教程，直接用win10自带的工具就能做到，但是前提是win10升级到1703之后的版本。

[用Win10自带的MBR2GPT无损转换GPT磁盘分区形式](https://www.windows10.pro/mbr2gpt/)

然后就是安装Ubuntu18.04了。我是安装在一个磁盘里，因此需要先空出一定大小的未分配空间。然后制作Ubuntu18.04的U盘启动项，选择UEFI+GPT组合模式。这里是官方教程：

[win系统上制作Ubuntu的U盘启动](https://tutorials.ubuntu.com/tutorial/tutorial-create-a-usb-stick-on-windows?_ga=2.119025098.2102352020.1539532514-1683076119.1539090178#0)

然后按照这个教程就好了： [Windows10+Ubuntu18.04双系统安装](https://blog.csdn.net/lnfxbianxiu/article/details/80394284)

## 配置深度学习环境

安装好Ubuntu18.04之后登录进去发现系统变漂亮了(但是还是一贯的难用，相比Mac和win)。可以进行一些美化操作。。 好像很多人喜欢这个，贴个教程吧： [Linux也可以这样美——Ubuntu18.04安装、配置、美化-踩坑记](https://www.jianshu.com/p/f9e905abea91)

之后就是配置我们的深度学习环境了。目前我主要用tensorflow，只记录这个。

主要步骤：

1. 安装Anaconda3， 更改源（包括ubuntu的软件源，conda的源， pip的源）。 参考[中科大源帮助文档](http://mirrors.ustc.edu.cn/help/index.html)
2. 禁用自带显卡驱动，安装适合自己显卡的驱动。这里推荐博客：[ubuntu18.04下搭建深度学习环境anaconda2+ cuda9.0+cudnn7.0.5+tensorflow1.7](https://www.cnblogs.com/zzb-Dream-90Time/p/9679779.html) 中的第二部分显卡驱动安装操作
3. 先用conda建立好tensorflow的Python环境: conda create --name tf-gpu-py36 python=3.6
   然后先看一下目前最新版本的tf依赖的cuda kit版本以及cudnn版本 ： conda install tensorflow-gpu
   这个命令输出一些包依赖信息之后就可以先停掉了。然后拿着这个cuda kit版本以及cudnn版本去nvida官网下载对应的驱动。 方法嘛，依然可以参考#2中博客教程。
4. 再次在tf-gpu-py36的环境中输入：  conda install tensorflow-gpu

好了，可以从GitHub上下点example跑起来了，CNN的计算有了1080TI的加持还是很快的，开心～～

## 后续

需要配置远程访问，jupyter notebook服务。远程Pycharm调试环境。
这里有个麻烦，就是家里是局域网，而且接的是长城渣宽带，没有独立IP，需要用frp中转一下。